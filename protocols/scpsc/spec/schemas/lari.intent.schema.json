{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "scpsc://schema/lari.intent.json",
  "title": "LARI Intent (SCPSC)",
  "type": "object",
  "required": ["lari_version", "intent_class", "intent_payload"],
  "properties": {
    "lari_version": { "type": "string" },
    "intent_class": {
      "type": "string",
      "enum": ["analyze","build","modify","deploy","observe","govern"]
    },
    "intent_payload": {
      "type": "object",
      "oneOf": [
        { "$ref": "#/$defs/analyzePayload" },
        { "$ref": "#/$defs/buildPayload" },
        { "$ref": "#/$defs/modifyPayload" },
        { "$ref": "#/$defs/deployPayload" },
        { "$ref": "#/$defs/observePayload" },
        { "$ref": "#/$defs/governPayload" }
      ]
    }
  },
  "additionalProperties": false,
  "$defs": {
    "analyzePayload": {
      "type": "object",
      "required": ["summary","mode"],
      "properties": {
        "summary": { "type": "string", "minLength": 1 },
        "mode": { "type": "string", "enum": ["static","runtime","log_review"] },
        "targets": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    },
    "buildPayload": {
      "type": "object",
      "required": ["summary","commands"],
      "properties": {
        "summary": { "type": "string", "minLength": 1 },
        "commands": { "type": "array", "minItems": 1, "items": { "type": "string" } },
        "fail_fast": { "type": "boolean" }
      },
      "additionalProperties": false
    },
    "modifyPayload": {
      "type": "object",
      "required": ["summary","changeset_id","rollback_required","targets"],
      "properties": {
        "summary": { "type": "string", "minLength": 1 },
        "changeset_id": { "type": "string", "minLength": 8 },
        "rollback_required": { "type": "boolean", "const": true },
        "targets": { "type": "array", "minItems": 1, "items": { "type": "string" } }
      },
      "additionalProperties": false
    },
    "deployPayload": {
      "type": "object",
      "required": ["summary","environment","artifact_ref"],
      "properties": {
        "summary": { "type": "string", "minLength": 1 },
        "environment": { "type": "string" },
        "artifact_ref": { "type": "string" },
        "rollback_plan_ref": { "type": "string" }
      },
      "additionalProperties": false
    },
    "observePayload": {
      "type": "object",
      "required": ["summary","channels"],
      "properties": {
        "summary": { "type": "string", "minLength": 1 },
        "channels": { "type": "array", "minItems": 1, "items": { "type": "string" } },
        "duration_s": { "type": "integer", "minimum": 1 }
      },
      "additionalProperties": false
    },
    "governPayload": {
      "type": "object",
      "required": ["summary","directive"],
      "properties": {
        "summary": { "type": "string", "minLength": 1 },
        "directive": { "type": "string", "enum": ["LOCKDOWN","REVOKE_DIA","REQUIRE_APPROVAL"] },
        "reason": { "type": "string" }
      },
      "additionalProperties": false
    }
  }
}
