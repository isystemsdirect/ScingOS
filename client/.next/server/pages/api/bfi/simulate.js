"use strict";(()=>{var a={};a.id=101,a.ids=[101],a.modules={217:(a,b,c)=>{c.d(b,{t:()=>d});function d(){return process.cwd()}},324:(a,b,c)=>{c.d(b,{Y:()=>d});function d(a,b){return String(a.headers["x-bdk-token"]??"").trim()?{actor:"bdk"}:(b.status(401).json({ok:!1,error:"Missing x-bdk-token"}),null)}},458:(a,b,c)=>{c.d(b,{Gu:()=>g,u0:()=>h});let d={phase:"pre_imprint",delegation:{mode:"assisted",scope:{blockedPaths:[".github/**","**/.env*","**/secrets/**","**/keys/**"],allowedPaths:[],canTouchAuthSecrets:!1,maxAutoRisk:"low",requiresApprovalAbove:"low"},bestOutcomeDefaults:!1}},e=new Map,f=new Map;function g(a){return e.get(a)??d}function h(a,b){let c=f.get(a)??[],d={ts:b.ts??new Date().toISOString(),type:String(b.type),actor:"string"==typeof b.actor?b.actor:void 0,...b};c.push(d),f.set(a,c)}},1088:(a,b,c)=>{c.d(b,{U:()=>d});async function d(a,b){}},2044:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>p,default:()=>o,handler:()=>n});var e=c(9046),f=c(8667),g=c(3480),h=c(6435),i=c(6925),j=c(8112),k=c(8766),l=c(1006),m=a([i]);i=(m.then?(await m)():m)[0];let o=(0,h.M)(i,"default"),p=(0,h.M)(i,"config"),q=new g.PagesAPIRouteModule({definition:{kind:f.A.PAGES_API,page:"/api/bfi/simulate",pathname:"/api/bfi/simulate",bundlePath:"",filename:""},userland:i,distDir:".next",relativeProjectDir:""});async function n(a,b,c){q.isDev&&(0,l.addRequestMeta)(a,"devRequestTimingInternalsEnd",process.hrtime.bigint());let d="/api/bfi/simulate",f=await q.prepare(a,b,{srcPage:d});if(!f){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{query:g,params:h,prerenderManifest:i,routerServerContext:m}=f;try{let c=a.method||"GET",e=(0,j.getTracer)(),f=e.getActiveScopeSpan(),l=q.instrumentationOnRequestError.bind(q),n=async f=>q.render(a,b,{query:{...g,...h},params:h,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:i.preview,propagateError:!1,dev:q.isDev,page:"/api/bfi/simulate",internalRevalidate:null==m?void 0:m.revalidate,onError:(...b)=>l(a,...b)}).finally(()=>{if(!f)return;f.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let a=e.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==k.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let g=a.get("next.route");if(g){let a=`${c} ${g}`;f.setAttributes({"next.route":g,"http.route":g,"next.span_name":a}),f.updateName(a)}else f.updateName(`${c} ${d}`)});f?await n(f):await e.withPropagatedContext(a.headers,()=>e.trace(k.BaseServerSpan.handleRequest,{spanName:`${c} ${d}`,kind:j.SpanKind.SERVER,attributes:{"http.method":c,"http.target":a.url}},n))}catch(a){if(q.isDev)throw a;(0,e.sendError)(b,500,"Internal Server Error")}finally{null==c.waitUntil||c.waitUntil.call(c,Promise.resolve())}}d()}catch(a){d(a)}})},2971:a=>{a.exports=import("zod")},3263:(a,b,c)=>{c.d(b,{G:()=>d});async function d(a,b,c){return{simulationHash:`sim_${b.id}_${Date.now()}`,intentId:b.id,output:c}}},5600:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6121:(a,b,c)=>{c.d(b,{l:()=>d});async function d(a,b){return{affectedFiles:[],affectedEngines:[],affectedPolicies:[],estimatedRisk:"low",confidenceScore:.75,explanation:`stub simulation for intent: ${b.id}`}}},6813:(a,b,c)=>{c.d(b,{Z:()=>d});function d(a){let b="string"==typeof a?a.toLowerCase():"";return"critical"===b?"critical":"high"===b?"high":"medium"===b?"medium":"low"}},6925:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>p});var e=c(2971),f=c(324),g=c(217),h=c(8008),i=c(6121),j=c(3263),k=c(1088),l=c(7265),m=c(458),n=c(6813),o=a([e]);let q=(e=(o.then?(await o)():o)[0]).z.object({intentId:e.z.string().min(1),iuPartnerId:e.z.string().min(1).optional()});async function p(a,b){if("POST"!==a.method)return b.status(405).json({ok:!1,error:"Method not allowed"});if(!(0,f.Y)(a,b))return;let c=q.safeParse(a.body);if(!c.success)return b.status(400).json({ok:!1,error:c.error.message});let d=(0,g.t)(),e=await (0,h.A)(d,c.data.intentId);if(!e)return b.status(404).json({ok:!1,error:"Intent not found"});if("declared"!==e.status)return b.status(409).json({ok:!1,error:`Intent must be in 'declared' status to simulate (current: ${e.status})`});let o=await (0,i.l)(d,e),p=await (0,j.G)(d,e,o),r={...e,status:"simulated"};await (0,h.O)(d,"intent.updated",r),await (0,k.U)(d,{ts:new Date().toISOString(),intent:r,simulation:p});let s=null;if(c.data.iuPartnerId)try{let a=(0,m.Gu)(c.data.iuPartnerId),b=(0,n.Z)(o.estimatedRisk);s=(0,l.C)({iuPartnerId:c.data.iuPartnerId,state:a,scope:a.delegation.scope,intentId:e.id,description:`Propose IU-first delegated next action for intent: ${e.description}`,simulation:{affectedFiles:o.affectedFiles,affectedEngines:o.affectedEngines,confidenceScore:o.confidenceScore},estimatedRisk:b}).plan}catch{s=null}return b.status(200).json({ok:!0,intentId:e.id,affectedFiles:o.affectedFiles,affectedEngines:o.affectedEngines,affectedPolicies:o.affectedPolicies||[],estimatedRisk:o.estimatedRisk,confidenceScore:o.confidenceScore,simulationHash:p.simulationHash,explanation:o.explanation||null,actionPlan:s})}d()}catch(a){d(a)}})},7265:(a,b,c)=>{c.d(b,{C:()=>d});function d(a){return{plan:{id:`plan_${Date.now()}`,kind:"run_task",description:a.description,risk:a.estimatedRisk,predictedImpact:{affectedFiles:a.simulation?.affectedFiles??[],affectedEngines:a.simulation?.affectedEngines??[],confidenceScore:a.simulation?.confidenceScore??.75},rollback:{strategy:"manual"},decisionWhy:"server:proposeActionPlan (stub)"},alternatives:[]}}},8008:(a,b,c)=>{c.d(b,{A:()=>e,O:()=>f});let d=new Map;async function e(a,b){return d.get(b)??null}async function f(a,b,c){d.set(c.id,c)}}};var b=require("../../../webpack-api-runtime.js");b.C(a);var c=b.X(0,[30],()=>b(b.s=2044));module.exports=c})();