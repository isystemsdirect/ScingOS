(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[735],{168:(s,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>u});var n=i(7876),t=i(9099),l=i(4232),a=i(2009),r=i(6543),d=i(2019),c=i(6846),o=i(2318);function u(){let s=(0,t.useRouter)(),{user:e,loading:i}=(0,c.n)(),u="string"==typeof s.query.id?s.query.id:null,[g,x]=(0,l.useState)(null),[h,m]=(0,l.useState)([]),[f,y]=(0,l.useState)(""),[p,j]=(0,l.useState)(null),v=(0,l.useMemo)(()=>!!(d.w9&&d.kA&&e&&u),[d.w9,e,u]);(0,l.useEffect)(()=>{if(!v||!d.kA||!e||!u)return;let s=null,i=!1;return(async()=>{j(null);try{let n=await (0,a.x7)((0,a.H9)(d.kA,"sessions",u));if(!n.exists()){x(null),m([]),j("Session not found.");return}let t=n.data();if(t.user_id!==e.uid){x(null),m([]),j("Access denied.");return}if(i)return;x(t);let l=(0,a.P)((0,o.Qb)(u),(0,a.My)("created_at","asc"));s=(0,a.aQ)(l,s=>{let e=s.docs.map(s=>({id:s.id,...s.data()}));m(e)},s=>{j(s?.message||"Failed to load messages.")})}catch(s){j(s?.message||"Failed to load session.")}})(),()=>{i=!0,s&&s()}},[v,u,e]);let S=(0,l.useCallback)(async()=>{if(!d.kA||!e||!u)return;let s=f.trim();if(s){j(null),y("");try{await (0,a.gS)((0,o.Qb)(u),{user_id:e.uid,role:"user",text:s,created_at:(0,a.O5)()}),await (0,a.mZ)((0,a.H9)(d.kA,"sessions",u),{last_activity:(0,a.O5)()})}catch(e){j(e?.message||"Failed to send message."),y(s)}}},[u,f,e]);return(0,n.jsx)(r.A,{title:u?`Session ${u.slice(0,8)}`:"Session",subtitle:"Messages (owner-only).",children:d.w9?i?(0,n.jsx)("div",{className:"scing-card",children:(0,n.jsx)("div",{className:"scing-subtle",style:{fontSize:12},children:"Loading…"})}):e?u?(0,n.jsxs)("div",{style:{display:"grid",gap:14},children:[p?(0,n.jsxs)("div",{className:"scing-card",style:{borderColor:"rgba(255,46,122,0.35)"},children:[(0,n.jsx)("div",{style:{fontSize:12,fontWeight:700},children:"Error"}),(0,n.jsx)("div",{className:"scing-subtle",style:{fontSize:12,marginTop:6},children:p})]}):null,(0,n.jsxs)("div",{className:"scing-card",children:[(0,n.jsx)("div",{style:{fontSize:12,fontWeight:800},children:"Transcript"}),(0,n.jsx)("div",{style:{marginTop:10,display:"grid",gap:10},children:0===h.length?(0,n.jsx)("div",{className:"scing-subtle",style:{fontSize:12},children:"No messages yet."}):h.map(s=>(0,n.jsxs)("div",{className:"scing-surface",style:{padding:12,borderRadius:14,border:"1px solid var(--stroke)"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:10},children:[(0,n.jsx)("div",{style:{fontSize:12,fontWeight:800},children:s.role.toUpperCase()}),(0,n.jsx)("div",{className:"scing-subtle",style:{fontSize:12},children:s.id.slice(0,6)})]}),(0,n.jsx)("div",{style:{marginTop:8,whiteSpace:"pre-wrap",fontSize:13},children:s.text})]},s.id))})]}),(0,n.jsxs)("div",{className:"scing-card",children:[(0,n.jsx)("div",{style:{fontSize:12,fontWeight:800},children:"Send"}),(0,n.jsxs)("div",{style:{marginTop:10,display:"grid",gap:10},children:[(0,n.jsx)("textarea",{value:f,onChange:s=>y(s.target.value),rows:3,className:"scing-input",placeholder:"Type a message…"}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:10},children:[(0,n.jsx)("button",{className:"scing-btn",onClick:()=>s.push("/sessions"),children:"Back"}),(0,n.jsx)("button",{className:"scing-btn scing-btn-primary",onClick:S,children:"Send"})]})]})]})]}):(0,n.jsx)("div",{className:"scing-card",children:(0,n.jsx)("div",{className:"scing-subtle",style:{fontSize:12},children:"Missing session id."})}):(0,n.jsxs)("div",{className:"scing-card",children:[(0,n.jsx)("div",{style:{fontSize:14,fontWeight:800},children:"Sign in required"}),(0,n.jsx)("div",{className:"scing-subtle",style:{fontSize:12,marginTop:6},children:"Sign in to view this session."})]}):(0,n.jsxs)("div",{className:"scing-card",children:[(0,n.jsx)("div",{style:{fontSize:14,fontWeight:800},children:"Bootstrap Mode"}),(0,n.jsx)("div",{className:"scing-subtle",style:{fontSize:12,marginTop:6},children:"Firebase is not configured."})]})})}},2318:(s,e,i)=>{"use strict";i.d(e,{Qb:()=>a,DV:()=>l});var n=i(2009);let t=i(2019).kA;function l(){return(0,n.rJ)(t,"sessions")}function a(s){return(0,n.rJ)(t,"sessions",s,"messages")}},6543:(s,e,i)=>{"use strict";i.d(e,{A:()=>r});var n=i(7876),t=i(7328),l=i.n(t),a=i(4681);function r({title:s,subtitle:e,children:i}){let t=s?`${s} - ScingOS`:"ScingOS";return(0,n.jsxs)(a.P,{children:[(0,n.jsx)(l(),{children:(0,n.jsx)("title",{children:t})}),(0,n.jsxs)("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[s?(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:s}),e?(0,n.jsx)("p",{className:"mt-2 text-gray-600",children:e}):null]}):null,i]})]})}},7680:(s,e,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/sessions/[id]",function(){return i(168)}])}},s=>{s.O(0,[305,681,636,593,792],()=>s(s.s=7680)),_N_E=s.O()}]);